
<!--<link rel="stylesheet" href="../css/easyui.css"/>
<link rel="stylesheet" href="../css/menu.css"/>
<script src="../js/jquery-3.2.1.min.js"></script>
<script src="../js/jquery.easyui.min.js"></script>-->


<form id="signform" method="post">
	<!--<table border="0" class="pwd-table" >-->
    <div class="pwd-table" width="40%">
    	<span class="tb-label">工号:</span><input type="text" id="userId" name="userId" class="easyui-validatebox textbox" style="margin-top:10px;margin-left:60px"/><br/>
    	<span class="tb-label">旧密码:</span><input type="text" id="oldPwd" name="oldPwd" class="easyui-validatebox textbox" style="margin-left:60px"/><br/>
        <span class="tb-label">新密码:</span><input type="password" id="newPwd" name="newPwd" class="easyui-validatebox textbox" style="margin-left:60px"/><br/>
        <span class="tb-label">再次输入密码:</span><input type="password" id="rePwd" name="rePwd" class="easyui-validatebox textbox" style="margin-left:60px"/><br/>
        <div class="alert">*密码不少于6位，且不能和旧密码一致</div>
        <span>
        	<input type="submit" class="easyui-linkbutton btn1" value="确认" />
            <input type="reset" class="easyui-linkbutton btn2" value="重置"/>
        </span>
    </div>
</form>
<script type="text/javascript">
// 自定义校验方法
jQuery.validator.addMethod("idCheck", function(value, element) {  
	var userId = $('#userId').val();
	$.ajax({
		type: 'GET',
		async: false,
		url: '../../../managesys/user/getUserById',
		data: {
			id: userId
		},
		success: function(data) {
			if(data == "false") {
				value = false;
			} else if(data == "error") {
				$.messager.alert('信息提示','服务器不可用','info');
			} else {
				value = true;
			}
			
		},
		error: function() {
			$.messager.alert('信息提示','服务器不可用','info');
		}
	});
	  return this.optional(element) || value;
}, "用户不存在"); 

jQuery.validator.addMethod("pwdCheck", function(value, element) {  
	var userId = $('#userId').val();
	var userPwd = $('#oldPwd').val();
	var result;
	$.ajax({
		type: 'GET',
		url: '../../../managesys/user/getUserByIdAndPwd',
		data: {
			id: userId,
			password: userPwd
		},
		async: false,
		success: function(data) {
			if(data == "false") {
				value = false;
			} else if(data == "error") {
				$.messager.alert('信息提示','服务器不可用','info');
			} else {
				value = true;
			}
			
		},
		error: function() {
			$.messager.alert('信息提示','服务器不可用','info');
		}
	});
	  return this.optional(element) || value;
}, "密码错误"); 

$().ready(function(){
	$('#signform').validate({
		rules:{
			userId: {
				required: true,
				idCheck: true
			},
			oldPwd: {
				required: true,	
				pwdCheck: true,
				minlength: 6,
				maxlength: 12
			},
			newPwd: {
				required: true,
				minlength: 6,
				maxlength: 12,	
				notEqualTo: "#oldPwd"
			},
			rePwd: {
				required: true,
				equalTo: "#newPwd"	
			}	
		},
		messages: {
			userId: {
				required: "该项为必填项",
				idCheck: "用户不存在！"
			},
			oldPwd: {
				required: "该项为必填项",
				pwdCheck: "密码不正确",
				minlength: "密码长度不小于6",
				maxlength: "密码长度不大于12",
			},
			newPwd: {
				required: "该项为必填项",
				minlength: "密码长度不小于6",
				maxlength: "密码长度不大于12",
				notEqualTo: "新密码不能和旧密码一样"	
			},
			rePwd: {
				required: "该项为必填项",
				equalTo: "两次密码输入不一致"	
			}
		},
		submitHandler:function(form){
			var userid = $('#userId').val();
			var userpwd = $('#newPwd').val();
			$.ajax({
				type: 'POST',
				async: false,
				url: '../../../managesys/user/editPassword',
				dataType: 'text',
				data: {
					id: userid,
					password: userpwd
				},
				success: function(data) {
					if(data == "success") {
						$.messager.alert('信息提示','密码修改成功,请记住新密码','info');
					} else {
						$.messager.alert('信息提示','密码修改失败','info');
					}
				},
				error: function(data) {
					$.messager.alert('信息提示','404出错了','info');
				}
			});
		}
			
	});	
});
//var text = document.getElementById('oldPwd').text();

	/*$().ready(function(){
		$('#signform').validatebox({
			rules: {
				oldPwd: {
					required: true,
					minlength: 6,
					maxlength: 12	
				},
				newPwd: {
					reuqired: true,
					minlength: 6,
					maxlength: 12	
				},
				rePwd: {
					reuqired: true,
					equalTo: "#newPwd"	
				}
			},
			message: {
				oldPwd: {
					required: "必填项",
					minlength: "长度不小于6",
					maxlength: "长度不大于12",	
				},
				newPwd: {
					required: "必填项",
					minlength: "长度不小于6",
					maxlength: "长度不大于12"
				},
				rePwd: {
					required: "必填项",
					equalTo: "必须与新密码一致"
				}
			}
		});
		submitHandler:function() {
			
		}
	});*/
</script>

